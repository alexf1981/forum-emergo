<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum Emergo - Habit Imperium</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <!-- PWA & Mobile -->
    <meta name="theme-color" content="#8E1600">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="icon.svg">
    <link rel="apple-touch-icon" href="icon.svg">
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Mock Icons (SVG) ---
        const Icons = {
            Check: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>,
            Sword: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"></polyline><line x1="13" y1="19" x2="19" y2="13"></line><line x1="16" y1="16" x2="20" y2="20"></line><line x1="19" y1="21" x2="21" y2="19"></line></svg>,
            Scroll: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>,
            Coin: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"></path><line x1="12" y1="18" x2="12" y2="22"></line><line x1="12" y1="2" x2="12" y2="6"></line></svg>,
            Temple: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 22h20"></path><path d="M6 18v-7"></path><path d="M10 18v-7"></path><path d="M14 18v-7"></path><path d="M18 18v-7"></path><path d="M4 11h16"></path><path d="M12 2l-8 7h16z"></path></svg>,
            Chart: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>,
            Menu: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>,
            Settings: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            Trash: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Edit: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
            X: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            Save: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
        };

        // --- Logic & Config ---
        const getTodayString = () => new Date().toISOString().split('T')[0];

        // --- RPG CONSTANTS ---
        const HERO_NAMES = ["Lucius", "Titus", "Marcus", "Aurelius", "Flavius", "Maximus", "Octavius", "Casius", "Valerius", "Felix"];
        const ITEMS = [
            { id: 'glad_bronze', name: 'Bronzen Gladius', type: 'weapon', bonus: 2, icon: 'ðŸ—¡ï¸', rarity: 'common' },
            { id: 'arm_leather', name: 'Leren Borstplaat', type: 'armor', bonus: 2, icon: 'ðŸ›¡ï¸', rarity: 'common' },
            { id: 'glad_iron', name: 'IJzeren Gladius', type: 'weapon', bonus: 4, icon: 'âš”ï¸', rarity: 'uncommon' },
            { id: 'arm_chain', name: 'MaliÃ«nkolder', type: 'armor', bonus: 4, icon: 'ðŸ›¡ï¸', rarity: 'uncommon' },
            { id: 'spear_legion', name: 'Legioenspeer', type: 'weapon', bonus: 6, icon: 'ðŸ”±', rarity: 'rare' },
            { id: 'shield_scutum', name: 'Scutum Schild', type: 'armor', bonus: 6, icon: 'ðŸ›¡ï¸', rarity: 'rare' },
            { id: 'sword_legend', name: 'Zwaard van Mars', type: 'weapon', bonus: 10, icon: 'ðŸ”¥', rarity: 'legendary' }
        ];
        const QUESTS = [
            { id: 'patrol', name: 'Stadspatrouille', level: 1, risk: 4, reward: 25, xp: 20, desc: 'Verjaag dronkenlappen en dieven.' },
            { id: 'bandits', name: 'Bandietenkamp', level: 3, risk: 12, reward: 60, xp: 50, desc: 'Val een kamp in het bos aan.' },
            { id: 'ruins', name: 'Vervloekte RuÃ¯nes', level: 5, risk: 25, reward: 150, xp: 120, desc: 'Verken duistere kerkers voor schatten.' }
        ];
        const ENEMY_TYPES = [
            { name: "Straatschoffie", str: 2 }, { name: "Wolvenroedel", str: 5 }, { name: "Gallische Krijger", str: 8 },
            { name: "Deserteur", str: 10 }, { name: "Oude Minotaurus", str: 15 }
        ];

        // --- Components ---
        const CityVisual = ({ rank, score }) => {
            let imageSrc = 'city_village.png';
            if (score >= 500) imageSrc = 'city_town.png';
            if (score >= 1000) imageSrc = 'city_capital.png';
            return (
                <div className="city-visual-container">
                    <img src={imageSrc} alt={`Stad status: ${rank}`} className="city-image" />
                    <div className="city-rank-badge">{rank}</div>
                </div>
            );
        };

        const SettingsModal = ({ onClose, onExport, onImport }) => {
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2>Systeembeheer</h2>
                            <button className="btn-icon" onClick={onClose}><Icons.X /></button>
                        </div>
                        <div className="modal-body">
                            <div className="card" style={{ marginBottom: '15px' }}>
                                <h3><Icons.Scroll /> Kronieken Schrijven</h3>
                                <p>Exporteer je voortgang naar een bestand om het veilig te bewaren.</p>
                                <button className="btn" onClick={onExport} style={{ width: '100%', marginTop: '10px' }}>Schrijf Kronieken (Export)</button>
                            </div>
                            <div className="card">
                                <h3><Icons.Scroll /> Kronieken Lezen</h3>
                                <p>Herstel je voortgang vanuit een eerder bestand.</p>
                                <input type="file" accept=".json" onChange={(e) => { if (e.target.files[0]) onImport(e.target.files[0]); }} style={{ marginTop: '10px', width: '100%' }} />
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---
        function App() {
            // === STATE ===
            const [activeTab, setActiveTab] = useState('city');
            const [showSettings, setShowSettings] = useState(false);
            const [editingHabitId, setEditingHabitId] = useState(null);

            const [stats, setStats] = useState(() => {
                const saved = localStorage.getItem('romestats');
                return saved ? JSON.parse(saved) : { gold: 200, army: 10, know: 0, pop: 100 };
            });

            const [habits, setHabits] = useState(() => {
                const saved = localStorage.getItem('romehabits');
                const initial = [{ id: 1, text: "Ochtendgymnastiek", completed: false, history: [] }, { id: 2, text: "Latijn studeren", completed: false, history: [] }];
                if (!saved) return initial;
                const parsed = JSON.parse(saved);
                return parsed.map(h => ({ ...h, history: Array.isArray(h.history) ? h.history : [] }));
            });

            const [heroes, setHeroes] = useState(() => {
                const saved = localStorage.getItem('romeheroes');
                let loaded = saved ? JSON.parse(saved) : [];
                return loaded.map(h => ({ ...h, items: h.items || [], maxHp: h.maxHp || 20 }));
            });

            const [combatLog, setCombatLog] = useState([]);
            const [selectedQuest, setSelectedQuest] = useState(null);
            const [notifications, setNotifications] = useState([]);
            const [combatEffects, setCombatEffects] = useState([]);

            // Persistence
            useEffect(() => {
                localStorage.setItem('romestats', JSON.stringify(stats));
                localStorage.setItem('romeheroes', JSON.stringify(heroes));
                localStorage.setItem('romehabits', JSON.stringify(habits));
            }, [stats, habits, heroes]);

            // Helpers
            const log = (msg) => setCombatLog(prev => [`[${new Date().toLocaleTimeString()}] ${msg}`, ...prev].slice(0, 20));
            const notify = (msg, type = 'info') => {
                const id = Date.now();
                setNotifications(prev => [...prev, { id, msg, type }]);
                setTimeout(() => setNotifications(prev => prev.filter(n => n.id !== id)), 3000);
            };

            // === ACTIONS: CITY ===
            const toggleHabit = (id) => {
                setHabits(prev => prev.map(h => {
                    if (h.id === id) {
                        const type = h.type || 'virtue';
                        const today = getTodayString();
                        const dailyCount = h.history.filter(d => d === today).length;
                        const isActive = dailyCount > 0;
                        let newHistory = [...h.history];

                        if (isActive) {
                            if (type === 'vice') {
                                setStats(s => ({ ...s, gold: s.gold + (20 * dailyCount), army: (s.army || 0) + (5 * dailyCount) }));
                            } else if (type === 'todo') {
                                setStats(s => ({ ...s, gold: Math.max(0, s.gold - 50) }));
                            } else {
                                setStats(s => ({ ...s, gold: Math.max(0, s.gold - (10 * dailyCount)), army: Math.max(0, (s.army || 0) - dailyCount) }));
                            }
                            newHistory = newHistory.filter(d => d !== today);
                        } else {
                            // ACTIVATE
                            if (type === 'vice') {
                                setStats(s => ({ ...s, gold: Math.max(0, s.gold - 20), army: Math.max(0, (s.army || 0) - 5) }));
                                notify("Betoont berouw! (-20 Goud)", "error");
                            } else if (type === 'todo') {
                                setStats(s => ({ ...s, gold: s.gold + 50 }));
                                notify("Taak voltooid! (+50 Goud)", "success");
                            } else {
                                setStats(s => ({ ...s, gold: s.gold + 10, army: (s.army || 0) + 1 }));
                            }
                            newHistory.push(today);
                        }
                        return { ...h, completed: !isActive, history: newHistory };
                    }
                    return h;
                }));
            };

            const incrementHabit = (id, e) => {
                e.stopPropagation();
                setHabits(prev => prev.map(h => {
                    if (h.id === id) {
                        const type = h.type || 'virtue';
                        const today = getTodayString();
                        if (type === 'todo') return h;

                        if (type === 'vice') {
                            setStats(s => ({ ...s, gold: Math.max(0, s.gold - 20), army: Math.max(0, (s.army || 0) - 5) }));
                            notify("De verleiding won... (-20 Goud)", "error");
                        } else {
                            setStats(s => ({ ...s, gold: s.gold + 10, army: (s.army || 0) + 1 }));
                        }
                        return { ...h, completed: true, history: [...h.history, today] };
                    }
                    return h;
                }));
            };

            const addHabit = (e) => {
                e.preventDefault();
                const form = e.target;
                const text = form.elements.habitText.value;
                const type = form.elements.habitType.value;
                const bucket = form.elements.bucket ? form.elements.bucket.checked : false;
                if (!text) return;
                setHabits([...habits, { id: Date.now(), text, type, bucket, completed: false, history: [] }]);
                form.reset();
            };

            const deleteHabit = (id) => {
                if (confirm('Zeker weten dat je deze activiteit wilt verwijderen?')) {
                    setHabits(prev => prev.filter(h => h.id !== id));
                }
            };

            const saveHabitEdit = (id, newText, newBucket) => {
                setHabits(prev => prev.map(h => h.id === id ? { ...h, text: newText, bucket: newBucket } : h));
                setEditingHabitId(null);
            };

            // === ACTIONS: RPG ===
            const calculateBattleResult = (hero, quest) => {
                const winChance = Math.min(0.9, (hero.str + hero.lvl) / (quest.risk * 1.5));
                const success = Math.random() < winChance;
                let earnedGold = 0, earnedXp = 0, lootMsg = "", dmgTaken = 0;
                let newItems = hero.items || [];

                if (success) {
                    earnedGold = quest.reward + Math.floor(Math.random() * 20);
                    earnedXp = quest.xp;
                    if (Math.random() < 0.3) {
                        const item = ITEMS[Math.floor(Math.random() * ITEMS.length)];
                        newItems = [...newItems, item];
                        lootMsg = ` | Gevonden: ${item.name}`;
                    }
                } else {
                    dmgTaken = Math.floor(Math.random() * 5) + 1;
                }

                let newXp = hero.xp + earnedXp;
                let newLvl = hero.lvl;
                let newStr = hero.str;
                let leveledUp = false;
                if (newXp >= newLvl * 100) {
                    newLvl++;
                    newXp = 0;
                    newStr += 2;
                    leveledUp = true;
                }

                return { success, earnedGold, earnedXp, lootMsg, newItems, newLvl, newStr, newXp, hp: Math.max(0, hero.hp - dmgTaken), dmgTaken, leveledUp };
            };

            const recruitHero = () => {
                if (stats.gold < 100) { notify("Niet genoeg goud! (Nodig: 100)", "error"); return; }
                const name = HERO_NAMES[Math.floor(Math.random() * HERO_NAMES.length)];
                const newHero = { id: Date.now(), name, lvl: 1, xp: 0, hp: 20, maxHp: 20, str: Math.floor(Math.random() * 3) + 3, items: [] };
                setStats(s => ({ ...s, gold: s.gold - 100 }));
                setHeroes([...heroes, newHero]);
                notify(`${name} is gerekruteerd!`, "success");
            };

            const goAdventure = (heroId, questId) => {
                const hero = heroes.find(h => h.id === heroId);
                const quest = QUESTS.find(q => q.id === questId);
                if (!quest) { notify("Selecteer eerst een missie type!", "warning"); return; }
                if (hero.hp <= 5) { notify(`${hero.name} is te gewond!`, "error"); return; }

                log(`âš”ï¸ ${hero.name} vertrekt: ${quest.name}...`);
                setTimeout(() => {
                    const result = calculateBattleResult(hero, quest);
                    if (result.success) {
                        log(`âœ… WINST! +${result.earnedXp} XP, +${result.earnedGold} Goud${result.lootMsg}`);
                        if (result.lootMsg) notify(result.lootMsg.replace(' | ', ''), "success");
                        setHeroes(prev => prev.map(h => {
                            if (h.id !== heroId) return h;
                            if (result.leveledUp) { log(`ðŸ†™ ${h.name} is nu level ${result.newLvl}! (+2 Str)`); notify(`${h.name} Level Up!`, "success"); }
                            return { ...h, xp: result.newXp, lvl: result.newLvl, str: result.newStr, hp: result.hp, items: result.newItems };
                        }));
                        setStats(s => ({ ...s, gold: s.gold + result.earnedGold }));
                    } else {
                        log(`âŒ NEDERLAAG! ${hero.name} vlucht... (-${result.dmgTaken} HP)`);
                        setHeroes(prev => prev.map(h => h.id === heroId ? { ...h, hp: result.hp } : h));
                        notify("Nederlaag...", "error");
                    }
                }, 500);
            };

            const fightBoss = () => {
                const totalStr = heroes.reduce((acc, h) => acc + h.str + h.items.reduce((s, i) => s + i.bonus, 0) + h.lvl, 0);
                log(`ðŸ² HYDRA GEVECHT! Totale Kracht: ${totalStr} vs 250`);
                if (totalStr > 250) {
                    log(`ðŸ† OVERWINNING! DE HYDRA IS VERSLAGEN!`);
                    notify("FORUM EMERGO IS EEUWIG!", "success");
                    setStats(s => ({ ...s, gold: s.gold + 50000 }));
                } else {
                    log(`ðŸ’€ Je legioen is te zwak!`);
                    notify("Legioen te zwak...", "error");
                }
            };

            const healHero = (id) => {
                if (stats.gold < 10) return;
                setStats(s => ({ ...s, gold: s.gold - 10 }));
                setHeroes(prev => prev.map(h => h.id === id ? { ...h, hp: h.maxHp } : h));
                log("Held is verzorgd.");
            };

            const handleExport = () => {
                const data = { romestats: stats, romehabits: habits, romeheroes: heroes };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `forum-emergo-backup-${getTodayString()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                notify("Kronieken opgeslagen!", "success");
            };

            const handleImport = (file) => {
                if (!confirm("Overschrijven?")) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.romestats) {
                            localStorage.setItem('romestats', JSON.stringify(data.romestats));
                            localStorage.setItem('romehabits', JSON.stringify(data.romehabits));
                            localStorage.setItem('romeheroes', JSON.stringify(data.romeheroes));
                            window.location.reload();
                        }
                    } catch (err) { notify("Fout bij lezen!", "error"); }
                };
                reader.readAsText(file);
            };

            // === RENDER ===
            const getScore = () => stats.gold + stats.army * 2 + stats.knowledge * 3;
            const getCityRank = () => {
                const s = getScore();
                if (s < 200) return "Dorp";
                if (s < 500) return "Handelspost";
                if (s < 1000) return "Stad";
                if (s < 2500) return "Provincie Hoofdstad";
                return "Keizerlijk Forum Emergo";
            };

            return (
                <div className="wrapper">
                    {showSettings && <SettingsModal onClose={() => setShowSettings(false)} onExport={handleExport} onImport={handleImport} />}
                    <div className="hero-banner">
                        <div className="hero-overlay header-content">
                            <h1>Forum Emergo</h1>
                            <div className="subtitle">Bouw je imperium, verover de wereld</div>
                        </div>
                    </div>

                    <div className="app-container">




                        {activeTab === 'city' && (
                            <div className="city-dashboard">
                                <div className="main-grid">
                                    {/* SIDEBAR */}
                                    <aside>
                                        <div className="card">
                                            <div className="card-title"><h3>Stad Status</h3></div>
                                            <CityVisual rank={getCityRank()} score={getScore()} />
                                            <div className="stat-row"><span className="resource gold"><Icons.Coin /> Goud</span><span>{stats.gold}</span></div>
                                            <div className="stat-row"><span className="resource army"><Icons.Sword /> Leger</span><span>{stats.army}</span></div>
                                        </div>
                                    </aside>

                                    {/* MAIN DASHBOARD */}
                                    <main className="city-dashboard-content" style={{ display: 'flex', flexDirection: 'column', gap: 'var(--spacing-md)', flexGrow: 1 }}>
                                        <div className="city-top-bar" style={{ display: 'flex', justifyContent: 'flex-end', background: 'white', padding: '10px', borderRadius: '4px', border: '1px solid var(--color-marble-dark)' }}>
                                            <form onSubmit={addHabit} className="city-form-compact" style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>
                                                <label style={{ fontSize: '0.85rem', display: 'flex', alignItems: 'center', gap: '4px', marginRight: '10px', cursor: 'pointer' }}>
                                                    <input name="bucket" type="checkbox" /> Eenmalig?
                                                </label>
                                                <input name="habitText" type="text" placeholder="Nieuwe activiteit..." style={{ width: '250px', padding: '8px' }} />
                                                <select name="habitType" style={{ padding: '8px', borderRadius: '4px', background: '#333', color: '#fff' }}>
                                                    <option value="virtue">Virtus</option>
                                                    <option value="vice">Barbaria</option>
                                                    <option value="todo">Mandatum</option>
                                                </select>
                                                <button className="btn" style={{ padding: '8px 16px', fontSize: '0.9rem' }}>+</button>
                                            </form>
                                        </div>

                                        <div className="city-columns-container">
                                            {['virtue', 'vice', 'todo'].map(colType => {
                                                const colTitle = colType === 'virtue' ? 'Virtutes' : colType === 'vice' ? 'Barbaria' : 'Mandata';
                                                const colColor = colType === 'virtue' ? '#4caf50' : colType === 'vice' ? '#ff4444' : '#2196f3';

                                                return (
                                                    <div className="city-col" key={colType}>
                                                        <div className="city-col-header" style={{ color: colColor, borderColor: colColor }}>{colTitle}</div>
                                                        <div className="city-col-content">
                                                            {habits.filter(h => (h.type || 'virtue') === colType).sort((a, b) => {
                                                                const today = getTodayString();
                                                                const aDone = a.history.includes(today);
                                                                const bDone = b.history.includes(today);
                                                                if (a.bucket && aDone && (!b.bucket || !bDone)) return 1;
                                                                if (b.bucket && bDone && (!a.bucket || !aDone)) return -1;
                                                                return 0;
                                                            }).map(h => {
                                                                const today = getTodayString();
                                                                const dailyCount = h.history.filter(d => d === today).length;
                                                                const isDone = dailyCount > 0;
                                                                const isDoneOneTime = h.bucket && isDone;

                                                                if (editingHabitId === h.id) {
                                                                    return (
                                                                        <div key={h.id} className="habit-item compact editing" style={{ flexDirection: 'column', alignItems: 'stretch' }}>
                                                                            <input type="text" defaultValue={h.text} id={`edit-text-${h.id}`} style={{ width: '100%', padding: '4px', marginBottom: '4px' }} />
                                                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                                                <label style={{ fontSize: '0.8rem' }}><input type="checkbox" defaultChecked={h.bucket} id={`edit-bucket-${h.id}`} /> Eenmalig?</label>
                                                                                <div style={{ display: 'flex', gap: '4px' }}>
                                                                                    <button className="btn-icon" onClick={() => saveHabitEdit(h.id, document.getElementById(`edit-text-${h.id}`).value, document.getElementById(`edit-bucket-${h.id}`).checked)}><Icons.Save /></button>
                                                                                    <button className="btn-icon" onClick={() => setEditingHabitId(null)}><Icons.X /></button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    );
                                                                }

                                                                return (
                                                                    <div key={h.id} className={`habit-item compact ${isDoneOneTime ? 'completed' : ''}`}
                                                                        style={{ borderLeft: `3px solid ${colColor}`, opacity: isDoneOneTime ? 0.5 : 1 }}>
                                                                        <div style={{ display: 'flex', alignItems: 'center', flexGrow: 1 }}>
                                                                            <div className={`habit-checkbox compact ${isDone ? 'checked' : ''}`} style={{ borderColor: colColor }} onClick={() => toggleHabit(h.id)}>
                                                                                {isDone && (colType === 'vice' ? <span style={{ color: colColor, fontWeight: 'bold' }}>X</span> : <Icons.Check style={{ width: 14, height: 14 }} />)}
                                                                            </div>
                                                                            <span className="habit-text" style={isDone && colType === 'todo' ? { textDecoration: 'line-through', color: '#888' } : {}}>
                                                                                {h.text}
                                                                                {!h.bucket && dailyCount > 1 && <span style={{ marginLeft: '4px', color: 'var(--color-gold)', fontWeight: 'bold' }}>x{dailyCount}</span>}
                                                                                {colType === 'vice' && dailyCount > 0 && <span style={{ marginLeft: '4px', color: '#ff4444', fontWeight: 'bold' }}>(-20g)</span>}
                                                                            </span>
                                                                        </div>

                                                                        <div className="habit-controls" style={{ display: 'flex', gap: '2px' }}>
                                                                            <button className="btn-icon small" onClick={() => setEditingHabitId(h.id)} title="Pas aan"><Icons.Edit /></button>
                                                                            <button className="btn-icon small" onClick={() => deleteHabit(h.id)} title="Verwijder"><Icons.Trash /></button>
                                                                            {!h.bucket && (
                                                                                <button className="btn-icon" style={{ borderColor: colColor, color: colColor, marginLeft: '4px' }} onClick={(e) => incrementHabit(h.id, e)}>+</button>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </main>
                                </div>
                            </div>
                        )}

                        {activeTab === 'tavern' && (
                            <div>
                                <div className="tavern-bg">
                                    <h2>De Vergulde Gladius</h2>
                                    <p>Recruteer helden voor je legioen</p>
                                    <div style={{ display: 'flex', gap: '20px', marginTop: '20px' }}>
                                        <button className="btn" onClick={recruitHero}>Nieuwe Held Rekruteren (100g)</button>
                                    </div>
                                    <div className="heroes-grid" style={{ marginTop: '20px' }}>
                                        {heroes.map(h => (
                                            <div key={h.id} className="card hero-card">
                                                <div className="card-title">{h.name} <span style={{ fontSize: '0.8em', color: '#aaa' }}>Lvl {h.lvl}</span></div>
                                                <div>XP: {h.xp} / {h.lvl * 100}</div>
                                                <div>HP: {h.hp} / {h.maxHp}</div>
                                                <div>Kracht: {h.str}</div>
                                                {h.hp < h.maxHp && <button className="btn-icon" onClick={() => healHero(h.id)}>â¤ï¸ Genees (10g)</button>}
                                                {h.items.length > 0 && (
                                                    <div className="inventory">
                                                        {h.items.map((i, idx) => <span key={idx} title={`${i.name} (+${i.bonus})`}>{i.icon}</span>)}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'adventure' && (
                            <div>
                                <h2>Campagne Kaart</h2>
                                <div className="adventure-grid">
                                    <div className="card">
                                        <h3>Missies</h3>
                                        {QUESTS.map(q => (
                                            <div key={q.id}
                                                className={`quest-item ${selectedQuest === q.id ? 'selected' : ''}`}
                                                onClick={() => setSelectedQuest(q.id)}>
                                                <h4>{q.name} (Lvl {q.level})</h4>
                                                <p>{q.desc}</p>
                                                <small>Risico: {q.risk} | Beloning: {q.reward}g</small>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="card">
                                        <h3>Selecteer Held</h3>
                                        {heroes.map(h => (
                                            <div key={h.id} style={{ display: 'flex', justifyContent: 'space-between', padding: '5px', borderRadius: '4px', background: h.hp <= 5 ? '#fdd' : '#eee', marginBottom: '5px' }}>
                                                <span>{h.name} (Str: {h.str})</span>
                                                <button className="btn" disabled={h.hp <= 5 || !selectedQuest} onClick={() => goAdventure(h.id, selectedQuest)}>Stuur op pad</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="card" style={{ marginTop: '20px', borderColor: '#d32f2f' }}>
                                    <h3 style={{ color: '#d32f2f' }}>Eindbaas: De Hydra</h3>
                                    <p>Verzamel een sterk legioen om het beest te verslaan.</p>
                                    <button className="btn" style={{ background: '#d32f2f', color: 'white' }} onClick={fightBoss}>VECHT TEGEN DE HYDRA</button>
                                </div>
                            </div>
                        )}

                        {/* Toast Container */}
                        <div className="toast-container">
                            {notifications.map(n => (
                                <div key={n.id} className={`toast ${n.type}`}>{n.msg}</div>
                            ))}
                        </div>
                    </div>

                    {/* Bottom Navigation */}
                    <div className="bottom-nav">
                        <div className="bottom-nav-content">
                            {/* Left: Gold Stats */}
                            <div className="nav-item stat-item edge-item">
                                <div className="nav-icon">
                                    <img src="nav_gold.jpg" alt="Goud" />
                                    <span className="nav-value">{stats.gold}</span>
                                </div>
                            </div>

                            {/* Center Group (Carousel) */}
                            <div className="nav-group-center">
                                {[
                                    { id: 'city', label: 'Plichten', icon: <img src="nav_plichten.jpg" alt="Plichten" /> },
                                    { id: 'tavern', label: 'Taverne', icon: <img src="nav_tavern.jpg" alt="Taverne" /> },
                                    { id: 'adventure', label: 'Quests', icon: <img src="nav_quests.jpg" alt="Quests" /> }
                                ].map(item => {
                                    const navOrder = ['city', 'tavern', 'adventure'];
                                    const activeIdx = navOrder.indexOf(activeTab);
                                    const itemIdx = navOrder.indexOf(item.id);
                                    const diff = (itemIdx - activeIdx + 3) % 3;

                                    let role = 'center';
                                    if (diff === 1) role = 'right';
                                    if (diff === 2) role = 'left';

                                    return (
                                        <button
                                            key={item.id}
                                            className={`nav-item ${activeTab === item.id ? 'active' : ''} role-${role}`}
                                            onClick={() => setActiveTab(item.id)}
                                            title={item.label}
                                        >
                                            <div className={`nav-icon ${role === 'center' ? 'large' : ''}`}>
                                                {item.icon}
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>

                            {/* Right: Profile/Settings */}
                            <button className="nav-item edge-item" onClick={(e) => { e.stopPropagation(); setShowSettings(true); }} title="Profiel">
                                <div className="nav-icon"><img src="nav_profile.jpg" alt="Profiel" /></div>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>